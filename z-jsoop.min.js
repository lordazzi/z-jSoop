/**
 * Z jSoop 1.0.3
 */
var Z=function(){};Z.defineApp=function(obj){if(obj.name===undefined)throw"Defina um namespace para seu projeto/alias no atributo 'name'";if(obj.path===undefined)throw"Defina a pasta da aplicação em 'path'";if(obj.path.match(/.+[^\/\\]$/))obj.path+='/';if(Z.exists(obj.name))throw"Uma variavel com o nome {0} já existe no escopo global.".format(obj.name);window[obj.name]={path:obj.path,name:obj.name,isZ:true};if(obj.main){if(obj.onLaunch===undefined)obj.onLaunch=function(){};var declaration=Z.declare(obj.main);declaration.onLoad(function(){Z.create(obj.main);});declaration.onLoad(obj.onLaunch);Z.Require([obj.main]);}};Z.exists=function(className){className=String(className);className=className.split('.');var scope=window;for(var i=0;i<className.length;i++){if(scope[className[i]])scope=scope[className[i]];else return false;}return scope;};Z.declare=function(className){var existe=Z.exists(className);if(existe){if(existe.isZ)return existe;else throw"Problema para declarar {0}, a variavel já existe.".format(className);}var names=className.split('.');var scope=window;var lastScope={};Z.each(names,function(name){if(!scope[name])scope[name]={};lastScope=scope;scope=scope[name];});var lastName=names.pop();var classe=function Base(config,oco){if(!oco)this.constructor(config);};classe.prototype.constructor=function(){throw"{0} ainda não está carregado".format(className);};classe.prototype.initConfig=function(){};classe.prototype.origin=classe;classe.identification=classe.prototype.identification=className;classe.empty=true;classe.isZ=classe.prototype.isZ=true;classe.onLoad=function(call){classe.todo.push(call);};classe.todo=[];return lastScope[lastName]=classe;};(function(){var Classe=function(name,definitions){var me=this;var classe;var RESERVADOS=['extend','mixins','singleton','statics','requires','config'];var constructor=function(){var existe=Z.exists(name);if(existe&&!existe.empty){throw"Uma classe com o nome {0} já foi definida".format(name);}validarDefinicoes(definitions);classe=Z.declare(name);if(!classe.empty)throw"Tentativa de declarar duas vezes a classe {0}".format(name);classe.empty=false;carregarDependencias(function(){setarPadroesDaClasse();implementarDefinicoes();chamarCallbacks();});return classe;};var validarDefinicoes=function(){if(definitions===undefined)definitions={};if(definitions instanceof Object){if(definitions.hasOwnProperty('extend')&&typeof definitions.extend!='string')throw"O parâmetro de configuração 'extend' deve conter uma string.";if(definitions.hasOwnProperty('singleton')&&typeof definitions.singleton!='boolean')throw"O parâmetro de configuração 'singleton' deve conter uma valor booleano.";if(definitions.hasOwnProperty('requires')){if(!definitions.requires instanceof Array)throw"O parâmetro de configuração 'requires' recebe um array de strings.";Z.each(definitions.requires,function(rec){if(typeof rec!='string'){throw"O parâmetro de configuração 'requires' recebe um array de strings.";}});}var deveSerUmObjeto="O parâmetro de configuração '{0}' recebe um objeto json";if(definitions.hasOwnProperty('statics')&&!definitions.statics instanceof Object)throw deveSerUmObjeto.format('statics');if(definitions.hasOwnProperty('config')&&!definitions.config instanceof Object)throw deveSerUmObjeto.format('config');if(definitions.hasOwnProperty('mixins')){if(!definitions.mixins instanceof Object)throw deveSerUmObjeto.format('mixins');Z.each(definitions.mixins,function(value,key){if(typeof value!='string')throw deveSerUmObjeto.format('mixins');if(typeof key!='string')throw deveSerUmObjeto.format('mixins');});}}else{throw"As definições da classe devem ser entregues em um objeto json";}};var setarPadroesDaClasse=function(){var constructBase=function constructor(config){this.initConfig(config);};classe.prototype.mixins={};adicionarMetodo('constructor',constructBase);adicionarMetodo('callParent',callParent);adicionarMetodo('initConfig',initConfig);adicionarMetodo('getParent',function(){return{constructor:constructBase};});classe.getDefinitions=function(){return definitions;};};var implementarDefinicoes=function(){if(definitions.extend)estender();if(definitions.mixins){if(definitions.mixins instanceof Array){Z.each(definitions.mixins,function(mixinName){misturar(null,mixinName);});}else if(definitions.mixins.constructor===Object){Z.each(definitions.mixins,function(mixinName,alias){misturar(alias,mixinName);});}}if(definitions.statics)setarMetodosEstaticos();if(definitions.config)setarConfigs();Z.each(definitions,function(call,nome){if(RESERVADOS.indexOf(nome)===-1)adicionarMetodo(nome,call);});};var chamarCallbacks=function(){classe.onLoad=function(call){Z.call(call,[classe]);};Z.each(classe.todo,function(call){Z.call(call,[classe]);});};var callParent=function(args){var me=this;var caller=callParent.caller;var params=args||[];if(!(params instanceof Array||params instanceof arguments.constructor)||false){throw"Argumento inválido para chamada de 'callParent', envie Array ou Arguments";}var owner=caller.owner.prototype;var parent=owner.getParent();var method=parent[caller.identification];if(typeof method=='function'){return method.apply(me,params);}else{throw"O método '{0}' não está sobrescrevendo nenhum método da classe pai para que callParent seja chamado.".format(method);}};var initConfig=function(config){var me=this;if(config&&config.constructor===Object){Z.each(config,function(value,key){var setter=gerarNomeDoMetodo('set',key);if(typeof me[setter]=='function'){me[setter](value);}else{me[key]=value;}});}};var carregarDependencias=function(call){var dependencias=[];dependencias=dependencias.concat(definitions.requires||[]);delete definitions.dependencias;if(definitions.extend)dependencias.push(definitions.extend);if(definitions.mixins){Z.each(definitions.mixins,function(value){dependencias.push(value);});}Z.Require(dependencias,call);};var setarMetodosEstaticos=function(){Z.each(definitions.statics,function(value,attr){classe[attr]=value;});};var adicionarMetodo=function(identification,call){if(call instanceof Object&&call.constructor!==Function){throw"{0}{1}{2}".format("Você não pode criar um propriedade que tenha um objeto por valor padrão,","isso fará com que todas as classes compartilhem da referência do mesmo.","Adicione o objeto manualmente sobrescrevendo o metodo constructor.");}call.identification=identification;call.owner=classe;classe.prototype[identification]=call;};var gerarNomeDoMetodo=function(prefixo,atributo){var letra=atributo[0].toUpperCase();atributo=atributo.replace(/^./,letra);return"{0}{1}".format(prefixo,atributo);};var setarConfigs=function(){var config=definitions.config;if(config.constructor===Object){Z.each(config,function(value,param){var _get=gerarNomeDoMetodo("get",param),_set=gerarNomeDoMetodo("set",param),_apply=gerarNomeDoMetodo("apply",param),_update=gerarNomeDoMetodo("update",param);var _param="_{0}".format(param);adicionarMetodo(_get,function(){return this[_param];});adicionarMetodo(_apply,function(v){return v;});adicionarMetodo(_update,function(){});adicionarMetodo(_set,function(v){var old=this[_param];v=this[_apply](v,old);this[_param]=v;if(v!==old){this[_update](v,old);}});classe.prototype[_param]=value;});}};var estender=function(){var nomePai=definitions.extend;var classePai=Z.exists(nomePai);if(classePai&&classePai.isZ){if(!classePai.singleton){var pai=new classePai(null,true);var defPai=classe.getDefinitions();if(defPai.statics){var stc={};Z.apply(stc,defPai.statics);Z.apply(stc,definitions.statics);definitions.statics=stc;}classe.prototype=new classePai(null,true);adicionarMetodo('getParent',function(){return pai;});adicionarMetodo('constructor',function(){this.callParent(arguments);});classe.prototype.identification=classe.identification;classe.prototype.origin=classe;}else{throw"Impossível estender da classe {0}, a classe é singleton.".format(nomeMix);}}else{throw"Impossível estender da classe {0}, a classe não foi declarada ou não é uma classe reconhecida".format(classePai);}};var misturar=function(alias,nomeMix){var mixin=Z.exists(nomeMix);if(mixin&&mixin.isZ){if(!mixin.singleton){var defs=mixin.getDefinitions();setarMetodosEstaticos(defs.statics);for(var key in mixin.prototype){if(classe.prototype[key]===undefined)classe.prototype[key]=mixin.prototype[key];}if(alias)classe.prototype.mixins[alias]=mixin.prototype;}else{throw"Impossível fazer mixin com a classe {0}, a classe é singleton.".format(nomeMix);}}else{throw"Impossível fazer mixin com a classe {0}, a classe não foi declarada ou não é uma classe reconhecida".format(nomeMix);}};return constructor();};Z.define=function(name,definitions){return new Classe(name,definitions);};})();Z.create=function(name,definitions){var obj;var classe=Z.exists(name);if(classe&&classe.isZ&&!classe.empty)obj=new classe(definitions);else Z.Require([name],function(){obj=new classe(definitions);console.warn('[{0}] carregada dinamicamente, operação de IO sincrona executada.'.format(name));},true);return obj;};Z.Loader=function(name,sync){if(typeof name!='string')throw"O nome da classe deve ser uma string";if(sync===undefined)sync=false;var classe=Z.exists(name);if(classe&&classe.isZ&&!classe.empty)return;var arr=name.split('.');var className=arr.pop();var namespace;if(arr.length)namespace=arr.shift();var path=arr.join('/');if(path)path="{0}/".format(path);path="{0}{1}.js".format(path,className);var namespacePath='';if(namespace)namespacePath=window[namespace].path||'';path="{0}{1}".format(namespacePath,path);Z.http({url:path,sync:sync,success:function(xhr){var content=xhr.responseText;eval(content);},failure:function(xhr){throw"Impossível carregar sistema, não foi possível carregar a classe {0}".format(name);}});};Z.Require=function(requires,call,sync){if(!requires.length){Z.call(call);return;}if(sync===undefined){sync=false;}var reqsLimpa=[];Z.each(requires,function(req){if(reqsLimpa.indexOf(req)==-1){reqsLimpa.push(req);}});var carregarei=reqsLimpa.length;var carregados=0;var quandoTerminar=function(){carregados++;if(carregarei==carregados)Z.call(call);};Z.each(reqsLimpa,function(req){var classe=Z.declare(req);classe.onLoad(quandoTerminar);Z.Loader(req,sync);});};Z.each=function(arr,callback){if(arr)if(typeof arr.splice=='function'&&typeof arr.length=='number'){for(var i=0;i<arr.length;i++){var isbreak=callback(arr[i],i);if(isbreak!==undefined){return isbreak;}}}else{for(var key in arr){if(arr.hasOwnProperty(key)){var isbreak=callback(arr[key],key);if(isbreak!==undefined){return isbreak;}}}}};Z.clone=function(json){if(json===null||json===undefined)return json;if(json.constructor===Date)return new Date(json.getTime());if(json.constructor===Array){var i=json.length;var arr=new Array(i);while(i--){arr[i]=Z.clone(json);}return arr;}if(json.constructor===Object){var novoJson={};for(var key in json){if(json.hasOwnProperty(key)){novoJson[key]=Z.clone(key);}}}if(!json instanceof Object)return json;console.warn("Possível clonar apenas objetos simples");return json;};Z.apply=function(json1,json2){if(!json1)json1={};if(!json2)json2={};if(json1.constructor!==Object)throw"Apply é executado apenas para objetos simples";if(json2.constructor!==Object)throw"Apply é executado apenas para objetos simples";Z.each(json2,function(val,key){json1[key]=val;});return json1;};Z.call=function(fn,args,scope){if(typeof fn=='function')return fn.apply(scope,args);};Z.http=function(args){if(args==undefined){args={};}if(args.url==undefined){args.url=location;}if(args.method==undefined){args.method='get';}if(args.sync==undefined){args.sync=false;}if(args.params==undefined){args.params={};}if(args.headers==undefined){args.headers={};}if(args.success==undefined){args.success=function(){};}if(args.failure==undefined){args.failure=function(){};}if(args.callback==undefined){args.callback=function(){};}var xhr=new XMLHttpRequest();Z.each(args.headers,function(value,header){if(!header&&!value){xhr.setRequestHeader(header,value);}});xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){args.success(xhr);}else{args.failure(xhr);}args.callback(xhr);}};var data=new FormData;Z.each(args.params,function(value,key){data.append(key,value)});xhr.open(args.method.toUpperCase(),args.url,!args.sync);xhr.send(data);};String.prototype.format=function(){var txt=this.valueOf();for(var i=0;i<arguments.length;i++){txt=txt.replace(new RegExp("[{]["+(i)+"][}]","g"),arguments[i])}return txt};Array.prototype.format=function(str){return str.format.apply(this)};